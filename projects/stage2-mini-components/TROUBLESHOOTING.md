# Stage 2 排障手册

## 1. 缓存命中率低

### 现象
- 后端查询量持续升高，缓存收益不明显。

### 定位
1. 检查 LRU/LFU 容量是否合理。
2. 结合 `monitoring.CacheMetrics.HitRatio()` 观察命中率趋势。
3. 运行 `go test ./test/performance -v` 评估不同容量下吞吐。

### 处理
- 提升容量并按业务热点分片。
- 优先 LFU 处理长尾热点场景。

## 2. 队列任务堆积

### 现象
- 延迟任务执行明显滞后。

### 定位
1. 检查 `delayqueue` 消费协程是否被阻塞。
2. 在压测中确认任务生产速率是否超过消费能力。

### 处理
- 提升消费者并发。
- 改用时间轮处理海量近似定时任务。

## 3. 熔断器频繁打开

### 现象
- 请求大量被快速拒绝。

### 定位
1. 观察失败阈值配置是否过低。
2. 确认下游依赖是否真实故障。

### 处理
- 分环境设置阈值与恢复窗口。
- 结合限流器减少突发冲击。

## 4. 限流误杀

### 现象
- 正常流量被拒绝。

### 定位
1. 检查令牌桶 `rate` 与 `burst` 是否匹配业务峰值。
2. 对比滑动窗口拒绝比例。

### 处理
- 提高突发容量并按接口分级限流。
