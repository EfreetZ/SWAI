# Stage 5 排障手册

## 1. 缓存雪崩

### 定位
1. 抽样 TTL 分布，检查是否集中到期。
2. 观察请求 QPS 与 DB 回源比例。

### 处理
- TTL 加随机偏移。
- 热 key 永不过期并异步刷新。

## 2. 热 Key 打满单节点

### 定位
1. 统计 key 访问频率。
2. 检查单连接吞吐与慢命令。

### 处理
- 对热点 key 做本地缓存。
- 在 cluster 模式下做 key 拆分。

## 3. AOF 文件持续膨胀

### 定位
1. 观察 AOF 文件大小曲线。
2. 检查 rewrite 是否触发。

### 处理
- 定期执行 rewrite。
- 降低重复写放大。

## 4. 主从复制延迟高

### 定位
1. 检查 master/slave offset 差值。
2. 观察 backlog 是否被覆盖。

### 处理
- 扩大 backlog。
- 提升 slave 应用命令吞吐。
